<html>
	<head>
		<title>Virtual Lab</title>
		<style>
      .lineChart {
        position: relative;
        float:left;
        margin-left: 0;
        width: 30%;
      }

		</style>
		<script src="js/d3.v4.js"></script>
		<script src="js/jquery-3.5.1.min.js"></script>
		<script src="js/VLApi.js"></script>
		<script src="js/DynamicLineChart.js"></script>
	</head>
	<body>
    <div id="my_dataviz" class="lineChart"></div>
    <div id="my_dataviz2" class="lineChart"></div>
    <div id="my_dataviz3" class="lineChart"></div>
	</body>

	<script>
        var samples = [];

        var api = new VLApi();
        $( document ).ready(function() {


        var lineChart1 = new DynamicLineChart("my_dataviz");
          api.getModels().then(function(models) {
            console.log(models);
            let model = models[5];
            createSample(model, "a", 0.1).then( function() {
              createSample(model, "a", 1)
            .then( function() {
              createSample(model, "a", 10)
            .then( function() {
              createSample(model, "a", 300)
            .then( function() {
              createSample(model, "b", 0.2)
            .then( function() {
              createSample(model, "b", 1.1)
            .then( function() {
              createSample(model, "b", 10.1)
            .then( function() {
              createSample(model, "b", 299.9);
            })})})})})})})/**/
            
            /*createSample(model, "a", 20);
            createSample(model, "a", 30);
            createSample(model, "b", 1.1);
            createSample(model, "b", 9.9);
            createSample(model, "b", 19.9);
            createSample(model, "b", 29.9);*/
          });
        });

        function updateSample(sample) {
          sample.update().then(function(data) {
              sample.nav.t += 10.0;
              console.log(sample.data);
              updateSample(sample);
              lineChart1.updateData(samples, function(d) {return d.name;}, function(d) {return d.params.substrate_k;}, function(d) {return d.data.mean_aflow;});
              lineChart2.updateData(samples, function(d) {return d.name;}, function(d) {return d.params.substrate_k;}, function(d) {return d.data.mean_traction;});
              lineChart3.updateData(samples, function(d) {return d.name;}, function(d) {return d.params.substrate_k;}, function(d) {return d.data.mean_nm;});
          });
        }

        function createSample(model, name, k) {   
          return new Promise(function(resolve, reject) {       
            model.getParameters().then(function(params) {
                console.log("params", name, k);
                params.substrate_k = k;
                model.create(params).then(function(sample) { 
                    console.log("samples", name, k);
                    sample.name = name;
                    sample.nav.t = 10.0;
                    samples.push(sample);
                    resolve();
                    updateSample(sample);
                });
            });
          });
        }

        var lineChart1 = new DynamicLineChart("my_dataviz");
        var lineChart2 = new DynamicLineChart("my_dataviz2");
        var lineChart3 = new DynamicLineChart("my_dataviz3");
        console.log(lineChart1);
        
        </script>
</html>
